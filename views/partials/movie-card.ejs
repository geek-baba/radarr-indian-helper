<div class="mb-8 bg-white rounded-lg shadow">
  <!-- Movie Header: Single poster and metadata -->
  <div class="p-6 border-b border-gray-200">
    <div class="flex gap-6">
      <!-- Poster -->
      <div class="flex-shrink-0">
        <% if (movie.posterUrl) { %>
          <img src="<%= movie.posterUrl %>" alt="<%= movie.movieTitle %>" class="w-32 h-48 object-cover rounded shadow">
        <% } else { %>
          <div class="w-32 h-48 bg-gray-200 rounded shadow flex items-center justify-center text-gray-400 text-xs text-center p-2">No Poster</div>
        <% } %>
      </div>
      
      <!-- Movie Info -->
      <div class="flex-1">
        <h3 class="text-2xl font-bold mb-3"><%= movie.movieTitle %></h3>
        <div class="flex flex-wrap gap-4 text-sm items-center">
          <% if (movie.imdbId) { %>
            <a href="https://www.imdb.com/title/<%= movie.imdbId %>" target="_blank" class="text-blue-600 hover:underline">IMDB</a>
          <% } %>
          <% if (movie.tmdbId) { %>
            <a href="https://www.themoviedb.org/movie/<%= movie.tmdbId %>" target="_blank" class="text-blue-600 hover:underline">TMDB</a>
          <% } %>
          <% if (movie.originalLanguage) { %>
            <span class="text-gray-600">Language: <%= movie.originalLanguage %></span>
          <% } %>
          <% if (movie.radarrMovieId && typeof radarrBaseUrl !== 'undefined') { %>
            <a href="<%= radarrBaseUrl %>/movie/<%= movie.radarrMovieId %>" target="_blank" class="text-blue-600 hover:underline">View in Radarr ðŸ”—</a>
          <% } %>
        </div>
        
        <!-- Summary counts and Radarr info -->
        <div class="mt-4 space-y-3">
          <div class="flex gap-4 text-sm">
            <% if (movie.add.length > 0) { %>
              <span class="px-3 py-1 bg-green-100 text-green-800 rounded">Add: <%= movie.add.length %></span>
            <% } %>
            <% if (movie.existing.length > 0) { %>
              <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded">
                Existing: <%= movie.existing.length %>
                <% if (movie.radarrInfo && movie.radarrInfo.fileName) { %>
                  <span class="text-xs ml-2 text-gray-600">(<%= movie.radarrInfo.fileName %>)</span>
                <% } %>
              </span>
            <% } %>
            <% if (movie.upgrade.length > 0) { %>
              <span class="px-3 py-1 bg-orange-100 text-orange-800 rounded">Upgrade: <%= movie.upgrade.length %></span>
            <% } %>
          </div>
          
          <!-- Radarr Info -->
          <% if (movie.radarrInfo) { %>
            <div class="text-sm">
              <% if (movie.radarrInfo.lastDownload && movie.radarrInfo.lastDownload.sourceTitle) { %>
                <div class="text-gray-700 mb-1">
                  <strong>Last Downloaded:</strong> <%= movie.radarrInfo.lastDownload.sourceTitle %>
                  <% if (movie.radarrInfo.lastDownload.date) { %>
                    <span class="text-gray-500 text-xs ml-2">(<%= new Date(movie.radarrInfo.lastDownload.date).toLocaleDateString() %>)</span>
                  <% } %>
                  <% if (movie.radarrInfo.lastDownload.releaseGroup) { %>
                    <span class="text-gray-500 text-xs ml-1">[<%= movie.radarrInfo.lastDownload.releaseGroup %>]</span>
                  <% } %>
                </div>
              <% } else if (movie.radarrInfo.fileName) { %>
                <div class="text-gray-700 mb-1">
                  <strong>Radarr File:</strong> <%= movie.radarrInfo.fileName %>
                </div>
              <% } else if (movie.radarrInfo.path) { %>
                <div class="text-gray-700 mb-1">
                  <strong>Radarr Path:</strong> <%= movie.radarrInfo.path.split('/').pop() %>
                </div>
              <% } %>
              <% if (movie.radarrInfo.resolution || movie.radarrInfo.codec || movie.radarrInfo.sourceTag || movie.radarrInfo.audio || movie.radarrInfo.sizeMb) { %>
                <div class="flex flex-wrap gap-1">
                  <% if (movie.radarrInfo.resolution) { %>
                    <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs"><%= movie.radarrInfo.resolution %></span>
                  <% } %>
                  <% if (movie.radarrInfo.codec) { %>
                    <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs"><%= movie.radarrInfo.codec %></span>
                  <% } %>
                  <% if (movie.radarrInfo.sourceTag) { %>
                    <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs"><%= movie.radarrInfo.sourceTag %></span>
                  <% } %>
                  <% if (movie.radarrInfo.audio) { %>
                    <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs"><%= movie.radarrInfo.audio %></span>
                  <% } %>
                  <% if (movie.radarrInfo.sizeMb) { %>
                    <span class="px-2 py-1 bg-gray-100 text-gray-800 rounded text-xs"><%= movie.radarrInfo.sizeMb.toFixed(2) %> MB</span>
                  <% } %>
                </div>
              <% } %>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>

  <!-- Releases List: All releases in a table format -->
  <div class="p-6">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Source</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Release Name</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Attributes</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <!-- Add Releases -->
          <% movie.add.forEach(release => { %>
            <tr class="bg-green-50">
              <td class="px-4 py-3 text-sm">
                <span class="font-medium"><%= release.feedName || release.source_site %></span>
                <div class="text-xs text-gray-500"><%= new Date(release.published_at).toLocaleString() %></div>
                <% if (release.link) { %>
                  <a href="<%= release.link %>" target="_blank" class="text-blue-600 hover:underline text-xs">ðŸ”—</a>
                <% } %>
              </td>
              <td class="px-4 py-3 text-sm font-mono text-gray-800"><%= release.title %></td>
              <td class="px-4 py-3 text-sm">
                <div class="flex flex-wrap gap-1">
                  <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs"><%= release.resolution %></span>
                  <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs"><%= release.codec %></span>
                  <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs"><%= release.source_tag %></span>
                  <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs"><%= release.audio %></span>
                  <% if (release.rss_size_mb) { %>
                    <span class="px-2 py-1 bg-gray-100 text-gray-800 rounded text-xs"><%= release.rss_size_mb.toFixed(2) %> MB</span>
                  <% } %>
                </div>
                <% if (release.audio_languages) { %>
                  <div class="text-xs text-gray-600 mt-1">Languages: <%= JSON.parse(release.audio_languages).join(', ') %></div>
                <% } %>
              </td>
              <td class="px-4 py-3 text-sm">
                <% if (release.status === 'ATTENTION_NEEDED') { %>
                  <span class="px-2 py-1 bg-yellow-200 text-yellow-800 rounded text-xs uppercase">ATTENTION NEEDED</span>
                  <div class="text-xs text-gray-500 mt-1">(No TMDB match)</div>
                <% } else { %>
                  <span class="px-2 py-1 bg-green-200 text-green-800 rounded text-xs uppercase">NEW</span>
                <% } %>
              </td>
              <td class="px-4 py-3 text-sm space-x-2">
                <button onclick="addMovie(<%= release.id %>)" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs">
                  Add to Radarr
                </button>
                <button onclick="ignoreRelease(<%= release.id %>)" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs">
                  Ignore
                </button>
              </td>
            </tr>
          <% }); %>

          <!-- Existing Releases -->
          <% movie.existing.forEach(release => { %>
            <tr class="bg-blue-50">
              <td class="px-4 py-3 text-sm">
                <span class="font-medium"><%= release.feedName || release.source_site %></span>
                <div class="text-xs text-gray-500"><%= new Date(release.published_at).toLocaleString() %></div>
                <% if (release.link) { %>
                  <a href="<%= release.link %>" target="_blank" class="text-blue-600 hover:underline text-xs">ðŸ”—</a>
                <% } %>
              </td>
              <td class="px-4 py-3 text-sm font-mono text-gray-800"><%= release.title %></td>
              <td class="px-4 py-3 text-sm">
                <div class="flex flex-wrap gap-1">
                  <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs"><%= release.resolution %></span>
                  <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs"><%= release.codec %></span>
                  <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs"><%= release.source_tag %></span>
                  <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs"><%= release.audio %></span>
                  <% if (release.rss_size_mb) { %>
                    <span class="px-2 py-1 bg-gray-100 text-gray-800 rounded text-xs"><%= release.rss_size_mb.toFixed(2) %> MB</span>
                  <% } %>
                </div>
                <% if (release.audio_languages) { %>
                  <div class="text-xs text-gray-600 mt-1">Languages: <%= JSON.parse(release.audio_languages).join(', ') %></div>
                <% } %>
              </td>
              <td class="px-4 py-3 text-sm">
                <span class="px-2 py-1 bg-blue-200 text-blue-800 rounded text-xs uppercase">EXISTING</span>
                <% if (release.status === 'IGNORED') { %>
                  <div class="text-xs text-gray-500 mt-1">(Below upgrade thresholds)</div>
                <% } %>
              </td>
              <td class="px-4 py-3 text-sm space-x-2">
                <button onclick="ignoreRelease(<%= release.id %>)" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs">
                  Ignore
                </button>
              </td>
            </tr>
          <% }); %>

          <!-- Upgrade Releases -->
          <% movie.upgrade.forEach(release => { %>
            <tr class="bg-orange-50">
              <td class="px-4 py-3 text-sm">
                <span class="font-medium"><%= release.feedName || release.source_site %></span>
                <div class="text-xs text-gray-500"><%= new Date(release.published_at).toLocaleString() %></div>
                <% if (release.link) { %>
                  <a href="<%= release.link %>" target="_blank" class="text-blue-600 hover:underline text-xs">ðŸ”—</a>
                <% } %>
              </td>
              <td class="px-4 py-3 text-sm font-mono text-gray-800"><%= release.title %></td>
              <td class="px-4 py-3 text-sm">
                <div class="flex flex-wrap gap-1">
                  <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs"><%= release.resolution %></span>
                  <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs"><%= release.codec %></span>
                  <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs"><%= release.source_tag %></span>
                  <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs"><%= release.audio %></span>
                  <% if (release.rss_size_mb) { %>
                    <span class="px-2 py-1 bg-gray-100 text-gray-800 rounded text-xs"><%= release.rss_size_mb.toFixed(2) %> MB</span>
                  <% } %>
                </div>
                <% if (release.audio_languages) { %>
                  <div class="text-xs text-gray-600 mt-1">Languages: <%= JSON.parse(release.audio_languages).join(', ') %></div>
                <% } %>
                <% if (release.radarr_existing_quality_score !== null && release.new_quality_score !== null) { %>
                  <div class="text-xs mt-1 text-gray-600">
                    <span>Score: <%= release.radarr_existing_quality_score.toFixed(2) %></span>
                    <span class="mx-1">â†’</span>
                    <span class="text-green-600 font-semibold"><%= release.new_quality_score.toFixed(2) %></span>
                    <span class="text-blue-600">(Î”<%= (release.new_quality_score - release.radarr_existing_quality_score).toFixed(2) %>)</span>
                  </div>
                <% } %>
              </td>
              <td class="px-4 py-3 text-sm">
                <span class="px-2 py-1 bg-orange-200 text-orange-800 rounded text-xs uppercase">UPGRADE</span>
              </td>
              <td class="px-4 py-3 text-sm space-x-2">
                <button onclick="upgradeMovie(<%= release.id %>)" class="bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded text-xs">
                  Upgrade
                </button>
                <button onclick="ignoreRelease(<%= release.id %>)" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs">
                  Ignore
                </button>
              </td>
            </tr>
          <% }); %>

          <!-- Ignored Releases -->
          <% if (movie.ignored && movie.ignored.length > 0) { %>
            <% movie.ignored.forEach(release => { %>
              <tr class="bg-gray-50">
                <td class="px-4 py-3 text-sm">
                  <span class="font-medium"><%= release.feedName || release.source_site %></span>
                  <div class="text-xs text-gray-500"><%= new Date(release.published_at).toLocaleString() %></div>
                  <% if (release.link) { %>
                    <a href="<%= release.link %>" target="_blank" class="text-blue-600 hover:underline text-xs">ðŸ”—</a>
                  <% } %>
                </td>
                <td class="px-4 py-3 text-sm font-mono text-gray-800"><%= release.title %></td>
                <td class="px-4 py-3 text-sm">
                  <div class="flex flex-wrap gap-1">
                    <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs"><%= release.resolution %></span>
                    <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs"><%= release.codec %></span>
                    <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs"><%= release.source_tag %></span>
                    <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs"><%= release.audio %></span>
                    <% if (release.rss_size_mb) { %>
                      <span class="px-2 py-1 bg-gray-100 text-gray-800 rounded text-xs"><%= release.rss_size_mb.toFixed(2) %> MB</span>
                    <% } %>
                  </div>
                  <% if (release.audio_languages) { %>
                    <div class="text-xs text-gray-600 mt-1">Languages: <%= JSON.parse(release.audio_languages).join(', ') %></div>
                  <% } %>
                  <% if (release.radarr_existing_quality_score !== null && release.new_quality_score !== null) { %>
                    <div class="text-xs mt-1 text-gray-600">
                      <span>Score: <%= release.radarr_existing_quality_score.toFixed(2) %></span>
                      <span class="mx-1">â†’</span>
                      <span class="text-gray-600"><%= release.new_quality_score.toFixed(2) %></span>
                      <span class="text-red-600">(Î”<%= (release.new_quality_score - release.radarr_existing_quality_score).toFixed(2) %>)</span>
                    </div>
                  <% } %>
                </td>
                <td class="px-4 py-3 text-sm">
                  <span class="px-2 py-1 bg-gray-200 text-gray-800 rounded text-xs uppercase">IGNORED</span>
                  <div class="text-xs text-gray-500 mt-1">
                    <% if (release.radarr_movie_id) { %>
                      (Below upgrade thresholds)
                    <% } else { %>
                      (Doesn't meet quality requirements)
                    <% } %>
                  </div>
                </td>
                <td class="px-4 py-3 text-sm space-x-2">
                  <!-- No actions for ignored releases -->
                </td>
              </tr>
            <% }); %>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>

