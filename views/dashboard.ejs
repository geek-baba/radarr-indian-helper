<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Radarr Indian Helper</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
  <nav class="bg-gray-800 text-white">
    <div class="container mx-auto px-4 py-3">
      <div class="flex justify-between items-center">
        <h1 class="text-xl font-bold">Radarr Indian Helper</h1>
        <div class="space-x-4">
          <a href="/" class="hover:text-gray-300">Dashboard</a>
          <a href="/settings" class="hover:text-gray-300">Settings</a>
        </div>
      </div>
    </div>
  </nav>
  <main class="container mx-auto px-4 py-8">
    <div class="mb-6 flex justify-between items-center">
      <h2 class="text-2xl font-bold">Dashboard</h2>
      <button onclick="refreshFeeds()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
        Refresh Feeds
      </button>
    </div>

    <% if (!movieGroups || movieGroups.length === 0) { %>
      <p class="text-gray-600">No releases found. Go to Settings to add RSS feeds and refresh.</p>
    <% } else { %>
      <% movieGroups.forEach(movie => { %>
        <div class="mb-8 bg-white rounded-lg shadow p-6">
          <h3 class="text-xl font-semibold mb-4"><%= movie.movieTitle %></h3>
          
          <!-- Add Section -->
          <% if (movie.add.length > 0) { %>
            <div class="mb-6">
              <h4 class="text-lg font-medium mb-3 text-green-600">Add (<%= movie.add.length %>)</h4>
              <div class="grid gap-4">
                <% movie.add.forEach(release => { %>
                  <div class="border-l-4 border-green-500 bg-green-50 rounded p-4">
                    <div class="flex justify-between items-start">
                      <div class="flex-1 flex gap-4">
                        <!-- Movie Poster -->
                        <div class="flex-shrink-0">
                          <% if (movie.posterUrl || release.posterUrl) { %>
                            <img src="<%= movie.posterUrl || release.posterUrl %>" alt="<%= movie.movieTitle %>" class="w-32 h-48 object-cover rounded shadow">
                          <% } else { %>
                            <div class="w-32 h-48 bg-gray-200 rounded shadow flex items-center justify-center text-gray-400 text-xs text-center p-2">No Poster</div>
                          <% } %>
                          <div class="mt-2 text-xs space-y-1">
                            <% if (movie.imdbId || release.imdbId) { %>
                              <a href="https://www.imdb.com/title/<%= movie.imdbId || release.imdbId %>" target="_blank" class="text-blue-600 hover:underline block">IMDB</a>
                            <% } %>
                            <% if (movie.tmdbId || release.tmdbId || release.tmdb_id) { %>
                              <a href="https://www.themoviedb.org/movie/<%= movie.tmdbId || release.tmdbId || release.tmdb_id %>" target="_blank" class="text-blue-600 hover:underline block">TMDB</a>
                            <% } %>
                            <% if (movie.originalLanguage || release.originalLanguage) { %>
                              <div class="text-gray-600">Lang: <%= movie.originalLanguage || release.originalLanguage %></div>
                            <% } %>
                          </div>
                        </div>
                        
                        <!-- Content -->
                        <div class="flex-1">
                          <div class="mb-3 p-3 bg-white rounded border">
                            <div class="font-medium text-gray-700 mb-2">
                              <strong><%= release.feedName || release.source_site %>:</strong> 
                              <span class="text-gray-600 font-normal"><%= release.title %></span>
                              <span class="text-gray-500 text-sm ml-2">- <%= new Date(release.published_at).toLocaleString() %></span>
                              <% if (release.link) { %>
                                <a href="<%= release.link %>" target="_blank" class="text-blue-600 hover:underline text-sm ml-2" title="View source">ðŸ”—</a>
                              <% } %>
                            </div>
                            <div class="text-sm mt-2">
                              <span class="font-medium">Resolution:</span> <span class="inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2"><%= release.resolution %></span>
                              <span class="font-medium ml-2">Codec:</span> <span class="inline-block bg-green-100 text-green-800 px-2 py-1 rounded mr-2"><%= release.codec %></span>
                              <span class="font-medium ml-2">Source:</span> <span class="inline-block bg-purple-100 text-purple-800 px-2 py-1 rounded mr-2"><%= release.source_tag %></span>
                              <span class="font-medium ml-2">Audio:</span> <span class="inline-block bg-yellow-100 text-yellow-800 px-2 py-1 rounded mr-2"><%= release.audio %></span>
                              <% if (release.rss_size_mb) { %>
                                <span class="font-medium ml-2">Size:</span> <span class="inline-block bg-gray-100 text-gray-800 px-2 py-1 rounded mr-2"><%= release.rss_size_mb.toFixed(2) %> MB</span>
                              <% } %>
                            </div>
                            <% if (release.audio_languages) { %>
                              <div class="text-sm mt-1">
                                <span class="font-medium">Languages:</span>
                                <span class="ml-2 text-gray-600"><%= JSON.parse(release.audio_languages).join(', ') %></span>
                              </div>
                            <% } %>
                            <div class="text-sm mt-2 text-gray-600">
                              <span class="font-medium">Status:</span>
                              <span class="ml-2 inline-flex items-center px-2 py-1 rounded bg-gray-200 text-gray-800 text-xs uppercase tracking-wide"><%= release.status %></span>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="ml-4 space-x-2">
                        <button onclick="addMovie(<%= release.id %>)" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded text-sm">
                          Add to Radarr
                        </button>
                        <button onclick="ignoreRelease(<%= release.id %>)" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded text-sm">
                          Ignore
                        </button>
                      </div>
                    </div>
                  </div>
                <% }); %>
              </div>
            </div>
          <% } %>

          <!-- Existing Section -->
          <% if (movie.existing.length > 0) { %>
            <div class="mb-6">
              <h4 class="text-lg font-medium mb-3 text-blue-600">Existing (<%= movie.existing.length %>)</h4>
              <div class="grid gap-4">
                <% movie.existing.forEach(release => { %>
                  <div class="border-l-4 border-blue-500 bg-blue-50 rounded p-4">
                    <div class="flex justify-between items-start">
                      <div class="flex-1 flex gap-4">
                        <!-- Movie Poster -->
                        <div class="flex-shrink-0">
                          <% if (release.posterUrl) { %>
                            <img src="<%= release.posterUrl %>" alt="<%= release.radarr_movie_title || release.title %>" class="w-32 h-48 object-cover rounded shadow">
                          <% } else { %>
                            <div class="w-32 h-48 bg-gray-200 rounded shadow flex items-center justify-center text-gray-400 text-xs text-center p-2">No Poster</div>
                          <% } %>
                          <div class="mt-2 text-xs space-y-1">
                            <% if (release.imdbId) { %>
                              <a href="https://www.imdb.com/title/<%= release.imdbId %>" target="_blank" class="text-blue-600 hover:underline block">IMDB</a>
                            <% } %>
                            <% if (release.tmdbId) { %>
                              <a href="https://www.themoviedb.org/movie/<%= release.tmdbId %>" target="_blank" class="text-blue-600 hover:underline block">TMDB</a>
                            <% } %>
                            <% if (release.originalLanguage) { %>
                              <div class="text-gray-600">Lang: <%= release.originalLanguage %></div>
                            <% } %>
                          </div>
                        </div>
                        
                        <!-- Content -->
                        <div class="flex-1">
                          <!-- RSS Release Attributes -->
                          <div class="mb-3 p-3 bg-white rounded border">
                            <div class="font-medium text-gray-700 mb-2">
                              <strong><%= release.feedName || release.source_site %>:</strong> 
                              <span class="text-gray-600 font-normal"><%= release.title %></span>
                              <span class="text-gray-500 text-sm ml-2">- <%= new Date(release.published_at).toLocaleString() %></span>
                              <% if (release.link) { %>
                                <a href="<%= release.link %>" target="_blank" class="text-blue-600 hover:underline text-sm ml-2" title="View source">ðŸ”—</a>
                              <% } %>
                            </div>
                            <div class="text-sm mt-2">
                              <span class="font-medium">Resolution:</span> <span class="inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2"><%= release.resolution %></span>
                              <span class="font-medium ml-2">Codec:</span> <span class="inline-block bg-green-100 text-green-800 px-2 py-1 rounded mr-2"><%= release.codec %></span>
                              <span class="font-medium ml-2">Source:</span> <span class="inline-block bg-purple-100 text-purple-800 px-2 py-1 rounded mr-2"><%= release.source_tag %></span>
                              <span class="font-medium ml-2">Audio:</span> <span class="inline-block bg-yellow-100 text-yellow-800 px-2 py-1 rounded mr-2"><%= release.audio %></span>
                              <% if (release.rss_size_mb) { %>
                                <span class="font-medium ml-2">Size:</span> <span class="inline-block bg-gray-100 text-gray-800 px-2 py-1 rounded mr-2"><%= release.rss_size_mb.toFixed(2) %> MB</span>
                              <% } %>
                            </div>
                            <% if (release.audio_languages) { %>
                              <div class="text-sm mt-1">
                                <span class="font-medium">Languages:</span>
                                <span class="ml-2 text-gray-600"><%= JSON.parse(release.audio_languages).join(', ') %></span>
                              </div>
                            <% } %>
                            <div class="text-sm mt-2 text-gray-600">
                              <span class="font-medium">Status:</span>
                              <span class="ml-2 inline-flex items-center px-2 py-1 rounded bg-blue-100 text-blue-800 text-xs uppercase tracking-wide"><%= release.status %></span>
                              <% if (release.status === 'IGNORED') { %>
                                <span class="ml-2 text-gray-500">(Below upgrade thresholds)</span>
                              <% } else if (release.status === 'ADDED') { %>
                                <span class="ml-2 text-gray-500">(Already in Radarr)</span>
                              <% } %>
                            </div>
                          </div>

                          <!-- Existing Radarr File Attributes -->
                          <% if (release.existing_file_attributes) { %>
                            <% const existingAttrs = JSON.parse(release.existing_file_attributes); %>
                            <div class="mb-3 p-3 bg-gray-50 rounded border">
                              <div class="font-medium text-gray-700 mb-2">
                                <strong>Radarr:</strong>
                                <% if (existingAttrs.lastDownload) { %>
                                  <span class="text-gray-600 font-normal"><%= existingAttrs.lastDownload.sourceTitle %></span>
                                  <span class="text-gray-500 text-sm ml-2">- Downloaded on <%= new Date(existingAttrs.lastDownload.date).toLocaleDateString() %></span>
                                <% } else if (release.radarr_movie_title) { %>
                                  <span class="text-gray-600 font-normal"><%= release.radarr_movie_title %></span>
                                <% } %>
                                <% if (release.radarr_movie_id && typeof radarrBaseUrl !== 'undefined') { %>
                                  <a href="<%= radarrBaseUrl %>/movie/<%= release.radarr_movie_id %>" target="_blank" class="text-blue-600 hover:underline text-sm ml-2" title="View in Radarr">ðŸ”—</a>
                                <% } %>
                              </div>
                              <div class="text-sm mt-2">
                                <span class="font-medium">Resolution:</span> <span class="inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2"><%= existingAttrs.resolution || 'N/A' %></span>
                                <span class="font-medium ml-2">Codec:</span> <span class="inline-block bg-green-100 text-green-800 px-2 py-1 rounded mr-2"><%= existingAttrs.codec || 'UNKNOWN' %></span>
                                <span class="font-medium ml-2">Source:</span> <span class="inline-block bg-purple-100 text-purple-800 px-2 py-1 rounded mr-2"><%= existingAttrs.sourceTag || 'OTHER' %></span>
                                <span class="font-medium ml-2">Audio:</span> <span class="inline-block bg-yellow-100 text-yellow-800 px-2 py-1 rounded mr-2"><%= existingAttrs.audio || 'Unknown' %></span>
                                <% if (existingAttrs.sizeMb) { %>
                                  <span class="font-medium ml-2">Size:</span> <span class="inline-block bg-gray-100 text-gray-800 px-2 py-1 rounded mr-2"><%= existingAttrs.sizeMb.toFixed(2) %> MB</span>
                                <% } %>
                              </div>
                              <% if (existingAttrs.audioLanguages && Array.isArray(existingAttrs.audioLanguages) && existingAttrs.audioLanguages.length > 0) { %>
                                <div class="text-sm mt-1">
                                  <span class="font-medium">Languages:</span>
                                  <span class="ml-2 text-gray-600"><%= existingAttrs.audioLanguages.join(', ') %></span>
                                </div>
                              <% } else if (existingAttrs.audioLanguages && typeof existingAttrs.audioLanguages === 'string') { %>
                                <div class="text-sm mt-1">
                                  <span class="font-medium">Languages:</span>
                                  <span class="ml-2 text-gray-600"><%= existingAttrs.audioLanguages %></span>
                                </div>
                              <% } %>
                            </div>
                          <% } else if (release.existing_size_mb) { %>
                            <div class="mb-2 text-sm text-gray-600">Existing Size: <%= release.existing_size_mb.toFixed(2) %> MB</div>
                          <% } %>
                        </div>
                      </div>
                      <div class="ml-4 space-x-2">
                        <button onclick="ignoreRelease(<%= release.id %>)" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded text-sm">
                          Ignore
                        </button>
                      </div>
                    </div>
                  </div>
                <% }); %>
              </div>
            </div>
          <% } %>

          <!-- Upgrade Section -->
          <% if (movie.upgrade.length > 0) { %>
            <div class="mb-6">
              <h4 class="text-lg font-medium mb-3 text-orange-600">Upgrade (<%= movie.upgrade.length %>)</h4>
              <div class="grid gap-4">
                <% movie.upgrade.forEach(release => { %>
                  <div class="border-l-4 border-orange-500 bg-orange-50 rounded p-4">
                    <div class="flex justify-between items-start">
                      <div class="flex-1 flex gap-4">
                        <!-- Movie Poster -->
                        <div class="flex-shrink-0">
                          <% if (release.posterUrl) { %>
                                    <img src="<%= release.posterUrl %>" alt="<%= release.radarr_movie_title || release.title %>" class="w-32 h-48 object-cover rounded shadow">
                          <% } else { %>
                            <div class="w-32 h-48 bg-gray-200 rounded shadow flex items-center justify-center text-gray-400 text-xs text-center p-2">No Poster</div>
                          <% } %>
                          <div class="mt-2 text-xs space-y-1">
                            <% if (release.imdbId) { %>
                              <a href="https://www.imdb.com/title/<%= release.imdbId %>" target="_blank" class="text-blue-600 hover:underline block">IMDB</a>
                            <% } %>
                            <% if (release.tmdbId) { %>
                              <a href="https://www.themoviedb.org/movie/<%= release.tmdbId %>" target="_blank" class="text-blue-600 hover:underline block">TMDB</a>
                            <% } %>
                            <% if (release.originalLanguage) { %>
                              <div class="text-gray-600">Lang: <%= release.originalLanguage %></div>
                            <% } %>
                          </div>
                        </div>
                        
                        <!-- Content -->
                        <div class="flex-1">
                          <!-- Side by side comparison -->
                          <div class="grid grid-cols-2 gap-4">
                            <!-- RSS Release -->
                            <div class="p-3 bg-white rounded border">
                              <div class="font-medium text-gray-700 mb-2">
                                <strong><%= release.feedName || release.source_site %>:</strong> 
                                        <span class="text-gray-600 font-normal text-sm"><%= release.title %></span>
                                <span class="text-gray-500 text-xs ml-2">- <%= new Date(release.published_at).toLocaleString() %></span>
                              </div>
                              <div class="text-sm mt-2">
                                <span class="font-medium">Resolution:</span> <span class="inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2"><%= release.resolution %></span>
                                <span class="font-medium ml-2">Codec:</span> <span class="inline-block bg-green-100 text-green-800 px-2 py-1 rounded mr-2"><%= release.codec %></span>
                                <span class="font-medium ml-2">Source:</span> <span class="inline-block bg-purple-100 text-purple-800 px-2 py-1 rounded mr-2"><%= release.source_tag %></span>
                                <span class="font-medium ml-2">Audio:</span> <span class="inline-block bg-yellow-100 text-yellow-800 px-2 py-1 rounded mr-2"><%= release.audio %></span>
                                <% if (release.rss_size_mb) { %>
                                  <span class="font-medium ml-2">Size:</span> <span class="inline-block bg-gray-100 text-gray-800 px-2 py-1 rounded mr-2"><%= release.rss_size_mb.toFixed(2) %> MB</span>
                                <% } %>
                              </div>
                              <% if (release.audio_languages) { %>
                                <div class="text-sm mt-1">
                                  <span class="font-medium">Languages:</span>
                                  <span class="ml-2 text-gray-600"><%= JSON.parse(release.audio_languages).join(', ') %></span>
                                </div>
                              <% } %>
                              <div class="text-sm mt-2 text-gray-600">
                                <span class="font-medium">Status:</span>
                                <span class="ml-2 inline-flex items-center px-2 py-1 rounded bg-orange-100 text-orange-800 text-xs uppercase tracking-wide"><%= release.status %></span>
                              </div>
                              <% if (release.new_quality_score !== null) { %>
                                <div class="text-sm mt-1">
                                  <span class="font-medium">Quality Score:</span>
                                  <span class="ml-2 text-green-600 font-semibold"><%= release.new_quality_score.toFixed(2) %></span>
                                </div>
                              <% } %>
                            </div>

                            <!-- Existing Radarr File -->
                            <% if (release.existing_file_attributes) { %>
                              <% const existingAttrs = JSON.parse(release.existing_file_attributes); %>
                              <div class="p-3 bg-gray-50 rounded border">
                                <div class="font-medium text-gray-700 mb-2">
                                  <strong>Radarr:</strong>
                                  <% if (existingAttrs.lastDownload) { %>
                                    <span class="text-gray-600 font-normal text-sm"><%= existingAttrs.lastDownload.sourceTitle %></span>
                                    <span class="text-gray-500 text-xs ml-2">- Downloaded on <%= new Date(existingAttrs.lastDownload.date).toLocaleDateString() %></span>
                                  <% } else if (release.radarr_movie_title) { %>
                                    <span class="text-gray-600 font-normal text-sm"><%= release.radarr_movie_title %></span>
                                  <% } %>
                                </div>
                                <% if (existingAttrs.path) { %>
                                  <div class="text-xs text-gray-500 font-mono mb-2 truncate" title="<%= existingAttrs.path %>"><%= existingAttrs.path %></div>
                                <% } %>
                                <div class="text-sm mt-2">
                                  <span class="font-medium">Resolution:</span> <span class="inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2"><%= existingAttrs.resolution || 'N/A' %></span>
                                  <span class="font-medium ml-2">Codec:</span> <span class="inline-block bg-green-100 text-green-800 px-2 py-1 rounded mr-2"><%= existingAttrs.codec || 'UNKNOWN' %></span>
                                  <span class="font-medium ml-2">Source:</span> <span class="inline-block bg-purple-100 text-purple-800 px-2 py-1 rounded mr-2"><%= existingAttrs.sourceTag || 'OTHER' %></span>
                                  <span class="font-medium ml-2">Audio:</span> <span class="inline-block bg-yellow-100 text-yellow-800 px-2 py-1 rounded mr-2"><%= existingAttrs.audio || 'Unknown' %></span>
                                  <% if (existingAttrs.sizeMb) { %>
                                    <span class="font-medium ml-2">Size:</span> <span class="inline-block bg-gray-100 text-gray-800 px-2 py-1 rounded mr-2"><%= existingAttrs.sizeMb.toFixed(2) %> MB</span>
                                  <% } %>
                                </div>
                                <% if (existingAttrs.audioLanguages && Array.isArray(existingAttrs.audioLanguages) && existingAttrs.audioLanguages.length > 0) { %>
                                  <div class="text-sm mt-1">
                                    <span class="font-medium">Languages:</span>
                                    <span class="ml-2 text-gray-600"><%= existingAttrs.audioLanguages.join(', ') %></span>
                                  </div>
                                <% } else if (existingAttrs.audioLanguages && typeof existingAttrs.audioLanguages === 'string') { %>
                                  <div class="text-sm mt-1">
                                    <span class="font-medium">Languages:</span>
                                    <span class="ml-2 text-gray-600"><%= existingAttrs.audioLanguages %></span>
                                  </div>
                                <% } %>
                                <% if (release.radarr_existing_quality_score !== null) { %>
                                  <div class="text-sm mt-1">
                                    <span class="font-medium">Quality Score:</span>
                                    <span class="ml-2 text-gray-600"><%= release.radarr_existing_quality_score.toFixed(2) %></span>
                                  </div>
                                <% } %>
                              </div>
                            <% } else { %>
                              <div class="p-3 bg-gray-50 rounded border">
                                <div class="font-medium text-gray-700 mb-2">Radarr:</div>
                                <div class="text-sm">
                                  <% if (release.radarr_movie_title) { %>
                                    <div><strong><%= release.radarr_movie_title %></strong></div>
                                  <% } %>
                                  <% if (release.existing_size_mb) { %>
                                    <div>Size: <%= release.existing_size_mb.toFixed(2) %> MB</div>
                                  <% } %>
                                  <% if (release.radarr_existing_quality_score !== null) { %>
                                    <div>Quality Score: <%= release.radarr_existing_quality_score.toFixed(2) %></div>
                                  <% } %>
                                </div>
                              </div>
                            <% } %>
                          </div>

                          <!-- Comparison Summary -->
                          <div class="mt-3 p-3 bg-yellow-50 rounded border">
                            <div class="text-sm">
                              <% if (release.existing_size_mb && release.rss_size_mb) { %>
                                <div class="mb-1">
                                  <span class="font-medium">Size:</span>
                                  <span class="text-gray-600"><%= release.existing_size_mb.toFixed(2) %> MB</span>
                                  <span class="mx-2">â†’</span>
                                  <span class="text-green-600 font-semibold"><%= release.rss_size_mb.toFixed(2) %> MB</span>
                                  <span class="text-blue-600 ml-2">
                                    (<%= ((release.rss_size_mb - release.existing_size_mb) / release.existing_size_mb * 100).toFixed(1) %>%)
                                  </span>
                                </div>
                              <% } %>
                              <% if (release.radarr_existing_quality_score !== null && release.new_quality_score !== null) { %>
                                <div>
                                  <span class="font-medium">Quality Score:</span>
                                  <span class="text-gray-600"><%= release.radarr_existing_quality_score.toFixed(2) %></span>
                                  <span class="mx-2">â†’</span>
                                  <span class="text-green-600 font-semibold"><%= release.new_quality_score.toFixed(2) %></span>
                                  <span class="text-blue-600 ml-2">(Î”<%= (release.new_quality_score - release.radarr_existing_quality_score).toFixed(2) %>)</span>
                                </div>
                              <% } %>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="ml-4 space-x-2">
                        <button onclick="upgradeMovie(<%= release.id %>)" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded text-sm">
                          Upgrade
                        </button>
                        <button onclick="ignoreRelease(<%= release.id %>)" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded text-sm">
                          Ignore
                        </button>
                      </div>
                    </div>
                  </div>
                <% }); %>
              </div>
            </div>
          <% } %>

          <!-- Summary -->
          <% if (movie.add.length === 0 && movie.existing.length === 0 && movie.upgrade.length === 0) { %>
            <p class="text-gray-600">No releases found for this movie.</p>
          <% } %>
        </div>
      <% }); %>
    <% } %>
  </main>

  <script>
    async function addMovie(id) {
      if (!confirm('Add this movie to Radarr?')) return;
      try {
        const res = await fetch(`/actions/${id}/add`, { method: 'POST' });
        const data = await res.json();
        if (data.success) {
          alert('Movie added to Radarr!');
          location.reload();
        } else {
          alert('Error: ' + (data.error || 'Unknown error'));
        }
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    async function upgradeMovie(id) {
      if (!confirm('Trigger upgrade search in Radarr?')) return;
      try {
        const res = await fetch(`/actions/${id}/upgrade`, { method: 'POST' });
        const data = await res.json();
        if (data.success) {
          alert('Upgrade search triggered!');
          location.reload();
        } else {
          alert('Error: ' + (data.error || 'Unknown error'));
        }
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    async function ignoreRelease(id) {
      if (!confirm('Ignore this release?')) return;
      try {
        const res = await fetch(`/actions/${id}/ignore`, { method: 'POST' });
        const data = await res.json();
        if (data.success) {
          location.reload();
        } else {
          alert('Error: ' + (data.error || 'Unknown error'));
        }
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    async function refreshFeeds() {
      if (!confirm('Refresh all RSS feeds? This may take a while.')) return;
      try {
        const res = await fetch('/settings/refresh', { method: 'POST' });
        const data = await res.json();
        if (data.success) {
          alert('Feed refresh started! The page will refresh in a few seconds.');
          setTimeout(() => location.reload(), 5000);
        } else {
          alert('Error: ' + (data.error || 'Unknown error'));
        }
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }
  </script>
</body>
</html>
